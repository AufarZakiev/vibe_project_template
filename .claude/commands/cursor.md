# AI-проверка Pull Request через Cursor

Автоматическая проверка PR с помощью Cursor AI.

## Параметры

$ARGUMENTS — номер PR (обязательный). Пример: `/cursor 19`

## Инструкции

### 1. Валидация параметров

Если `$ARGUMENTS` пустой или не является числом:
- Запросить номер PR у пользователя через AskUserQuestion
- Альтернативно: получить список открытых PR командой `gh pr list` и предложить выбор

### 2. Получение информации о PR

```bash
gh pr view $ARGUMENTS --json title,body,headRefName,baseRefName,number,url
```

Сохранить информацию о PR для дальнейшего анализа.

### 3. Получение изменений в PR

```bash
gh pr diff $ARGUMENTS
```

Проанализировать изменения в коде.

### 4. Анализ кода с помощью Cursor AI

Используя возможности Cursor AI:
1. Проанализировать изменения на предмет:
   - Потенциальных багов и ошибок
   - Нарушений архитектуры проекта
   - Несоответствий стилю кода
   - Проблем с безопасностью
   - Производительности
   - Тестового покрытия

2. Проверить соответствие:
   - Документации проекта (AGENTS.md, agent_docs/)
   - Существующим паттернам кода
   - ADR (Architecture Decision Records)

### 5. Анализ замечаний

Для каждого найденного замечания:

1. **Определить приоритет:**
   - P1 (Critical) — исправить перед мержем
   - P2 (Important) — рекомендуется исправить
   - Suggestions — на усмотрение

2. **Оценить обоснованность:**
   - Проверить, указывает ли замечание на реальную проблему
   - Учесть контекст проекта и существующие соглашения

3. **Предложить действия:**
   - Если замечание обосновано — предложить исправление кода
   - Если ложноположительное — объяснить почему можно игнорировать

### 6. Применение исправлений (если требуется)

После согласования с пользователем:

1. Внести исправления в код
2. Закоммитить и запушить:
   ```bash
   git add . && git commit -m "fix: address Cursor AI review comments" && git push
   ```
3. Повторно запустить проверку (вернуться к шагу 3)

### 7. Ожидание деплоя (после одобрения)

Когда критичных замечаний не осталось:

```bash
sleep 300
```

Дождаться завершения GitHub Action деплоя.

### 8. Завершение

Сообщить пользователю:
- Статус проверки (все замечания обработаны / остались suggestions)
- Готовность PR к мержу
- Статус деплоя (если применимо)

## Поведение

- Всегда показывать замечания пользователю перед исправлением
- Спрашивать подтверждение перед каждым циклом повторной проверки
- При отсутствии замечаний — сразу переходить к ожиданию деплоя
- Использовать TodoWrite для отслеживания прогресса при множественных замечаниях
- Учитывать контекст проекта из agent_docs/ при анализе
